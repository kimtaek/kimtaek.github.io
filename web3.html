<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Web3 Sandbox</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <script
      src="https://unpkg.com/react@latest/umd/react.development.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/react-dom@latest/umd/react-dom.development.js"></script>
    <script
      src="https://unpkg.com/@mui/material@latest/umd/material-ui.production.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://unpkg.com/@babel/standalone@latest/babel.min.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://releases.jquery.com/git/jquery-git.js"></script>
    <!-- Fonts to support Material Design -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    />
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
    // https://mui.com/material-ui/react-text-field/
      const {
	      Divider,
	      TextField,
        colors,
        CssBaseline,
        useMediaQuery,
        ThemeProvider,
        Typography,
        Container,
        createTheme,
        Box,
        Button,
        SvgIcon,
        Link,
        List,
        ListItem,
        ListItemText,
        TableContainer
      } = MaterialUI;

      const theme = createTheme({
        palette: {
          primary: {
            light: '#333',
            main: '#000',
            dark: '#000',
            contrastText: '#fff',
          },
        },
      });

      function Copyright() {
        return (
          <Typography variant="body2" color="text.secondary" align="center">
            {'Copyright Â© '}
            <Link color="inherit" href="#">
              Web3 Sandbox
            </Link>{' '}
            {new Date().toISOString()}
            {'.'}
          </Typography>
        );
      }

      function RootPage() {
        // const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');
        // const theme = React.useMemo(
        //   () =>
        //     createTheme({
        //       palette: {
        //         mode: prefersDarkMode ? 'dark' : 'light',
        //       },
        //     }),
        //   [prefersDarkMode],
        // );

        return (
          <ThemeProvider theme={theme}>
            <CssBaseline />
            <App />
          </ThemeProvider>
        );
			}

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<RootPage/>);
      
      // function flush() {
	    //   root.render(<RootPage/>);
      // }
      // setInterval(flush, 500);

      let account = '';

		  async function getAccount() {
        $('#account').text("Address: ");
        let accounts = await ethereum.request({ method: 'eth_requestAccounts' });
				account = accounts[0];
        $('#account').text("Address: " + account);
      }
      
      async function sendTransaction() {
        const params = JSON.parse($("#sendTransactionData").val());
        const tx = await ethereum.request({
            method: 'eth_sendTransaction',
            params: [
                params
            ],
        });
        console.log(tx)
    }

    ethereum.on('accountsChanged', function(accounts) {
	    console.log('----------')
			$('#account').text("Address: ");
    });
    
      function App() {
        return (
          <Container maxWidth="sm">
            <Box sx={{ my: 4 }}>
              <Typography variant="h4" component="h1" gutterBottom>Web3 Sandbox</Typography>
							<Divider />
              <br/>
              <Button onClick={getAccount} variant="contained" color="primary" id="account">Address: - </Button>
              <br/><br/>
              <TextField
                id="standard-multiline-flexible"
                label="Transaction (JSON)"
                multiline
                fullWidth
                rows={13}
                color="primary"
							  focused
                id="sendTransactionData"
              />
              <br/><br/>
              <Button onClick={sendTransaction} variant="contained" color="primary">Submit</Button>
              <br/><br/>
              
              <List
                sx={{
                  width: '100%',
                  maxWidth: 360,
                  bgcolor: 'background.paper',
                  position: 'relative',
                  overflow: 'auto',
                  maxHeight: 300,
                  '& ul': { padding: 0 },
                }}
                subheader={<li />}
              >

              </List>

              <br/><br/>
              <Copyright />
            </Box>
          </Container>
        );
      }

    </script>
  </body>
</html>
