<!DOCTYPE html>
<html lang="en">

<head>
    <title>Web3 Sandbox</title>
    <meta charset="utf-8" />
    <meta content="initial-scale=1, width=device-width" name="viewport" />
    <script crossorigin="anonymous" src="https://unpkg.com/react@latest/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@latest/umd/react-dom.development.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/@mui/material@latest/umd/material-ui.production.min.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/@babel/standalone@latest/babel.min.js"></script>
    <script src="https://releases.jquery.com/git/jquery-git.js"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        // https://mui.com/material-ui/react-text-field/
    const {
        Divider,
        TextField,
        CssBaseline,
        ThemeProvider,
        Typography,
        Container,
        createTheme,
        Box,
        Button,
        Link,
        List,
        ListItem,
        ListItemText,
    } = MaterialUI;

    const theme = createTheme({
        palette: {
            primary: {
                light: '#333',
                main: '#000',
                dark: '#000',
                contrastText: '#fff',
            },
        },
    });

    function Copyright() {
        return (
            <Typography variant="body2" color="text.secondary" align="center">
                {'Copyright Â© '}
                <Link color="inherit" href="#">
                    Web3 Sandbox
                </Link>{' '}
                {new Date().getFullYear()}
                {'.'}
            </Typography>
        );
    }

    function RootPage() {
        // const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');
        // const theme = React.useMemo(
        //   () =>
        //     createTheme({
        //       palette: {
        //         mode: prefersDarkMode ? 'dark' : 'light',
        //       },
        //     }),
        //   [prefersDarkMode],
        // );

        return (
            <ThemeProvider theme={theme}>
                <CssBaseline />
                <App />
            </ThemeProvider>
        );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<RootPage/>);

    let account = '';
    async function getAccount() {
        $('#account').text("Address: -");
        let accounts = await ethereum.request({ method: 'eth_requestAccounts' });
        account = accounts[0];
        $('#account').text("Address: " + account);
    }

    async function sendTransaction() {
    	try {
		    const params = JSON.parse($("#sendTransactionData").val());
            const tx = await ethereum.request({
                method: 'eth_sendTransaction',
                params: [params],
            });

            var txt = $("#transactions");
            let original = txt.val();
            let originalArray = original.split("\n");

            if (originalArray.length > 5) {
                originalArray.shift();
                originalArray.shift();
            }

            txt.val(originalArray.join("\n") + "\n" + tx + "\n");
	    } catch (e) {
	        return false;
        }
    }

    ethereum.on('accountsChanged', function(accounts) {
        if (accounts.length === 0) {
            $('#account').text("Address: -");
        } else if (accounts[0] !== account) {
            console.log('METAMASK: accountsChanged')
            account = accounts[0];
            $('#account').text("Address: " + account);
        }
    });

   $(document).ready(function(){
       $("#sendTransactionData").change(function(){
           try {
               let data = JSON.parse($("#sendTransactionData").val());
               $("#sendTransactionData").val(JSON.stringify(data, null, 2))
           } catch (e) {}
       }); 
   });
   
    function App() {
        return (
            <Container maxWidth="md">
                <Box sx={{ my: 4 }}>
                    <Typography variant="h4" component="h1" gutterBottom>Web3 Sandbox</Typography>
                    <Divider />
                    <br/>
                    <Button onClick={getAccount} variant="contained" color="primary" id="account">Address: -</Button>
                    <br/><br/>
                    <TextField
                        id="sendTransactionData"
                        label="Transaction (JSON)"
                        multiline
                        fullWidth
                        focused
                        rows={13}
                        color="primary"
                    />
                    <br/><br/>
                    <Button onClick={sendTransaction} variant="contained" color="primary">Submit</Button>
                    <br/><br/>
                    <Divider />
                   
					<Box sx={{ my: 3 }}>
                        <Typography variant="h4" component="h1" gutterBottom></Typography>
                        <TextField
                            id="transactions"
                            label="Transactions"
                            multiline
                            fullWidth
                            focused
                            rows={7}
                            color="primary"
                            InputProps={{
                              readOnly: true,
                            }}
                        />
                    </Box>
                    <br/><br/>
                    <Copyright />
                </Box>
            </Container>
        );
    }
</script>
</body>

</html>
